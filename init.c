/*
	日立ベーシックマスターJr.エミュレータ
	設定
*/

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <fcntl.h>
#include <limits.h>
#include <sys/stat.h>
#include "bm2.h"

/* キーボード */
#define KEYBOARD_EN	0	/* 英語 */
#define KEYBOARD_JP	1	/* 日本語 */
#define KEYBOARD_DE	2	/* ドイツ語 */

/* キー割り当て */
struct KeyAssign {
	int bmkey;	/* MB-6885仮想キーコード */
	int key;	/* PCキーコード */
};

/* オプション y/n */
const static OptTable tableYesNo[] = {
	{ "y", TRUE },
	{ "yes", TRUE },
	{ "n", FALSE },
	{ "no", FALSE },
	{ NULL, 0 }
};

/* オプション RAMサイズ */
const static OptTable tableRam[] = {
	{ "16k", 0x3fff },
	{ "64k", 0xffff },
	{ NULL, 0 }
};

/* オプション MB-6885仮想キーコード */
const static OptTable tableBmkey[] = {
	{ "z", BMKEY_Z },
	{ "x", BMKEY_X },
	{ "c", BMKEY_C },
	{ "v", BMKEY_V },
	{ "b", BMKEY_B },
	{ "n", BMKEY_N },
	{ "m", BMKEY_M },
	{ ",", BMKEY_COMMA },
	{ ".", BMKEY_PERIOD },
	{ "/", BMKEY_SLASH },
	{ "_", BMKEY_UNDERBAR },
	{ "space", BMKEY_SPACE },
	{ "a", BMKEY_A },
	{ "s", BMKEY_S },
	{ "d", BMKEY_D },
	{ "f", BMKEY_F },
	{ "g", BMKEY_G },
	{ "h", BMKEY_H },
	{ "j", BMKEY_J },
	{ "k", BMKEY_K },
	{ "l", BMKEY_L },
	{ ";", BMKEY_SEMICOLON },
	{ ":", BMKEY_COLON },
	{ "]", BMKEY_RIGHTBRACKET },
	{ "return", BMKEY_RETURN },
	{ "q", BMKEY_Q },
	{ "w", BMKEY_W },
	{ "e", BMKEY_E },
	{ "r", BMKEY_R },
	{ "t", BMKEY_T },
	{ "y", BMKEY_Y },
	{ "u", BMKEY_U },
	{ "i", BMKEY_I },
	{ "o", BMKEY_O },
	{ "p", BMKEY_P },
	{ "@", BMKEY_AT },
	{ "[", BMKEY_LEFTBRACKET },
	{ "1", BMKEY_1 },
	{ "2", BMKEY_2 },
	{ "3", BMKEY_3 },
	{ "4", BMKEY_4 },
	{ "5", BMKEY_5 },
	{ "6", BMKEY_6 },
	{ "7", BMKEY_7 },
	{ "8", BMKEY_8 },
	{ "9", BMKEY_9 },
	{ "0", BMKEY_0 },
	{ "-", BMKEY_MINUS },
	{ "^", BMKEY_CARET },
	{ "\\", BMKEY_YEN },
	{ "alpha", BMKEY_ALPHA },
	{ "ashift", BMKEY_ASHIFT },
	{ "kshift", BMKEY_KSHIFT },
	{ "kana", BMKEY_KANA },
	{ "break", BMKEY_BREAK },
	{ "backward", BMKEY_OVERWRITE },
	{ "forward", BMKEY_APPEND },
	{ NULL, 0 }
};

/* オプション PCのキーボードの種類 */
const static OptTable tableKeyboard[] = {
	{ "en", KEYBOARD_EN },
	{ "jp", KEYBOARD_JP },
	{ "de", KEYBOARD_DE },
	{ NULL, 0 }
};

/* オプション PCのキーコード */
static OptTable tableKey[] = {
	{ "none", KEY_NONE },
	/* 英語キーボード(デフォルト) */
#define INDEX_TABLE_KEY_BACKSPACE	1
	{ "backspace", KEY_BACKSPACE },
#define INDEX_TABLE_KEY_TAB	2
	{ "tab", KEY_TAB },
#define INDEX_TABLE_KEY_CLEAR	3
	{ "clear", KEY_CLEAR },
#define INDEX_TABLE_KEY_RETURN	4
	{ "return", KEY_RETURN },
#define INDEX_TABLE_KEY_PAUSE	5
	{ "pause", KEY_PAUSE },
#define INDEX_TABLE_KEY_ESCAPE	6
	{ "escape", KEY_ESCAPE },
#define INDEX_TABLE_KEY_SPACE	7
	{ "space", KEY_SPACE },
#define INDEX_TABLE_KEY_QUOTE	8
	{ "'", KEY_QUOTE },
#define INDEX_TABLE_KEY_COMMA	9
	{ ",", KEY_COMMA },
#define INDEX_TABLE_KEY_MINUS	10
	{ "-", KEY_MINUS },
#define INDEX_TABLE_KEY_PERIOD	11
	{ ".", KEY_PERIOD },
#define INDEX_TABLE_KEY_SLASH	12
	{ "/", KEY_SLASH },
#define INDEX_TABLE_KEY_0	13
	{ "0", KEY_0 },
#define INDEX_TABLE_KEY_1	14
	{ "1", KEY_1 },
#define INDEX_TABLE_KEY_2	15
	{ "2", KEY_2 },
#define INDEX_TABLE_KEY_3	16
	{ "3", KEY_3 },
#define INDEX_TABLE_KEY_4	17
	{ "4", KEY_4 },
#define INDEX_TABLE_KEY_5	18
	{ "5", KEY_5 },
#define INDEX_TABLE_KEY_6	19
	{ "6", KEY_6 },
#define INDEX_TABLE_KEY_7	20
	{ "7", KEY_7 },
#define INDEX_TABLE_KEY_8	21
	{ "8", KEY_8 },
#define INDEX_TABLE_KEY_9	22
	{ "9", KEY_9 },
#define INDEX_TABLE_KEY_SEMICOLON	23
	{ ";", KEY_SEMICOLON },
#define INDEX_TABLE_KEY_EQUALS	24
	{ "=", KEY_EQUALS },
#define INDEX_TABLE_KEY_LEFTBRACKET	25
	{ "[", KEY_LEFTBRACKET },
#define INDEX_TABLE_KEY_BACKSLASH	26
	{ "\\", KEY_BACKSLASH },
#define INDEX_TABLE_KEY_RIGHTBRACKET	27
	{ "]", KEY_RIGHTBRACKET },
#define INDEX_TABLE_KEY_A	28
	{ "a", KEY_A },
#define INDEX_TABLE_KEY_B	29
	{ "b", KEY_B },
#define INDEX_TABLE_KEY_C	30
	{ "c", KEY_C },
#define INDEX_TABLE_KEY_D	31
	{ "d", KEY_D },
#define INDEX_TABLE_KEY_E	32
	{ "e", KEY_E },
#define INDEX_TABLE_KEY_F	33
	{ "f", KEY_F },
#define INDEX_TABLE_KEY_G	34
	{ "g", KEY_G },
#define INDEX_TABLE_KEY_H	35
	{ "h", KEY_H },
#define INDEX_TABLE_KEY_I	36
	{ "i", KEY_I },
#define INDEX_TABLE_KEY_J	37
	{ "j", KEY_J },
#define INDEX_TABLE_KEY_K	38
	{ "k", KEY_K },
#define INDEX_TABLE_KEY_L	39
	{ "l", KEY_L },
#define INDEX_TABLE_KEY_M	40
	{ "m", KEY_M },
#define INDEX_TABLE_KEY_N	41
	{ "n", KEY_N },
#define INDEX_TABLE_KEY_O	42
	{ "o", KEY_O },
#define INDEX_TABLE_KEY_P	43
	{ "p", KEY_P },
#define INDEX_TABLE_KEY_Q	44
	{ "q", KEY_Q },
#define INDEX_TABLE_KEY_R	45
	{ "r", KEY_R },
#define INDEX_TABLE_KEY_S	46
	{ "s", KEY_S },
#define INDEX_TABLE_KEY_T	47
	{ "t", KEY_T },
#define INDEX_TABLE_KEY_U	48
	{ "u", KEY_U },
#define INDEX_TABLE_KEY_V	49
	{ "v", KEY_V },
#define INDEX_TABLE_KEY_W	50
	{ "w", KEY_W },
#define INDEX_TABLE_KEY_X	51
	{ "x", KEY_X },
#define INDEX_TABLE_KEY_Y	52
	{ "y", KEY_Y },
#define INDEX_TABLE_KEY_Z	53
	{ "z", KEY_Z },
#define INDEX_TABLE_KEY_DELETE	54
	{ "delete", KEY_DELETE },
#define INDEX_TABLE_KEY_KP0	55
	{ "n0", KEY_KP0 },
#define INDEX_TABLE_KEY_KP1	56
	{ "n1", KEY_KP1 },
#define INDEX_TABLE_KEY_KP2	57
	{ "n2", KEY_KP2 },
#define INDEX_TABLE_KEY_KP3	58
	{ "n3", KEY_KP3 },
#define INDEX_TABLE_KEY_KP4	59
	{ "n4", KEY_KP4 },
#define INDEX_TABLE_KEY_KP5	60
	{ "n5", KEY_KP5 },
#define INDEX_TABLE_KEY_KP6	61
	{ "n6", KEY_KP6 },
#define INDEX_TABLE_KEY_KP7	62
	{ "n7", KEY_KP7 },
#define INDEX_TABLE_KEY_KP8	63
	{ "n8", KEY_KP8 },
#define INDEX_TABLE_KEY_KP9	64
	{ "n9", KEY_KP9 },
#define INDEX_TABLE_KEY_KP_PERIOD	65
	{ "n.", KEY_KP_PERIOD },
#define INDEX_TABLE_KEY_KP_DIVIDE	66
	{ "n/", KEY_KP_DIVIDE },
#define INDEX_TABLE_KEY_KP_MULTIPLY	67
	{ "n*", KEY_KP_MULTIPLY },
#define INDEX_TABLE_KEY_KP_MINUS	68
	{ "n-", KEY_KP_MINUS },
#define INDEX_TABLE_KEY_KP_PLUS	69
	{ "n+", KEY_KP_PLUS },
#define INDEX_TABLE_KEY_KP_ENTER	70
	{ "nenter", KEY_KP_ENTER },
#define INDEX_TABLE_KEY_KP_EQUALS	71
	{ "n=", KEY_KP_EQUALS },
#define INDEX_TABLE_KEY_UP	72
	{ "up", KEY_UP },
#define INDEX_TABLE_KEY_DOWN	73
	{ "down", KEY_DOWN },
#define INDEX_TABLE_KEY_RIGHT	74
	{ "right", KEY_RIGHT },
#define INDEX_TABLE_KEY_LEFT	75
	{ "left", KEY_LEFT },
#define INDEX_TABLE_KEY_INSERT	76
	{ "insert", KEY_INSERT },
#define INDEX_TABLE_KEY_HOME	77
	{ "home", KEY_HOME },
#define INDEX_TABLE_KEY_END	78
	{ "end", KEY_END },
#define INDEX_TABLE_KEY_PAGEUP	79
	{ "pageup", KEY_PAGEUP },
#define INDEX_TABLE_KEY_PAGEDOWN	80
	{ "pagedown", KEY_PAGEDOWN },
#define INDEX_TABLE_KEY_F1	81
	{ "f1", KEY_F1 },
#define INDEX_TABLE_KEY_F2	82
	{ "f2", KEY_F2 },
#define INDEX_TABLE_KEY_F3	83
	{ "f3", KEY_F3 },
#define INDEX_TABLE_KEY_F4	84
	{ "f4", KEY_F4 },
#define INDEX_TABLE_KEY_F5	85
	{ "f5", KEY_F5 },
#define INDEX_TABLE_KEY_F6	86
	{ "f6", KEY_F6 },
#define INDEX_TABLE_KEY_F7	87
	{ "f7", KEY_F7 },
#define INDEX_TABLE_KEY_F8	88
	{ "f8", KEY_F8 },
#define INDEX_TABLE_KEY_F9	89
	{ "f9", KEY_F9 },
#define INDEX_TABLE_KEY_F10	90
	{ "f10", KEY_F10 },
#define INDEX_TABLE_KEY_F11	91
	{ "f11", KEY_F11 },
#define INDEX_TABLE_KEY_F12	92
	{ "f12", KEY_F12 },
#define INDEX_TABLE_KEY_F13	93
	{ "f13", KEY_F13 },
#define INDEX_TABLE_KEY_F14	94
	{ "f14", KEY_F14 },
#define INDEX_TABLE_KEY_F15	95
	{ "f15", KEY_F15 },
#define INDEX_TABLE_KEY_NUMLOCK	96
	{ "numlock", KEY_NUMLOCK },
#define INDEX_TABLE_KEY_CAPSLOCK	97
	{ "capslock", KEY_CAPSLOCK },
#define INDEX_TABLE_KEY_SCROLLOCK	98
	{ "scrolllock", KEY_SCROLLOCK },
#define INDEX_TABLE_KEY_RSHIFT	99
	{ "rshift", KEY_RSHIFT },
#define INDEX_TABLE_KEY_LSHIFT	100
	{ "lshift", KEY_LSHIFT },
#define INDEX_TABLE_KEY_RCTRL	101
	{ "rctrl", KEY_RCTRL },
#define INDEX_TABLE_KEY_LCTRL	102
	{ "lctrl", KEY_LCTRL },
#define INDEX_TABLE_KEY_RALT	103
	{ "ralt", KEY_RALT },
#define INDEX_TABLE_KEY_LALT	104
	{ "lalt", KEY_LALT },
#define INDEX_TABLE_KEY_MODE	105
	{ "mode", KEY_MODE },
#define INDEX_TABLE_KEY_COMPOSE	106
	{ "compose", KEY_COMPOSE },
#define INDEX_TABLE_KEY_HELP	107
	{ "help", KEY_HELP },
#define INDEX_TABLE_KEY_PRINT	108
	{ "print", KEY_PRINT },
#define INDEX_TABLE_KEY_SYSREQ	109
	{ "sysreq", KEY_SYSREQ },
#define INDEX_TABLE_KEY_BREAK	110
	{ "break", KEY_BREAK },
#define INDEX_TABLE_KEY_MENU	111
	{ "menu", KEY_MENU },
#define INDEX_TABLE_KEY_POWER	112
	{ "power", KEY_POWER },
	/* 日本語キーボード */
#define INDEX_TABLE_KEY_COLON	113
	{ ":", KEY_QUOTE },
#define INDEX_TABLE_KEY_AT	114
	{ "@", KEY_LEFTBRACKET },
#define INDEX_TABLE_KEY_CARET	115
	{ "^", KEY_EQUALS },
#define INDEX_TABLE_KEY_UNDERBAR	116
	{ "_", KEY_UNDERBAR },
#define INDEX_TABLE_KEY_KANA	117
	{ "kana", KEY_KANA },
#define INDEX_TABLE_KEY_YEN	118
	{ "yen", KEY_YEN },
#define INDEX_TABLE_XFER	119
	{ "xfer", KEY_XFER },
#define INDEX_TABLE_NFER	120
	{ "nfer", KEY_NFER },
	/* ドイツ語キーボード */
#define INDEX_TABLE_KEY_HASH	121
	{ "hash", KEY_BACKSLASH },
#define INDEX_TABLE_KEY_PLUS	122
	{ "+", KEY_RIGHTBRACKET },
#define INDEX_TABLE_KEY_ACUTE	123
	{ "acute", KEY_EQUALS },
#define INDEX_TABLE_KEY_SZLIG	124
	{ "szlig", KEY_MINUS },
#define INDEX_TABLE_KEY_AUML	125
	{ "auml", KEY_QUOTE },
#define INDEX_TABLE_KEY_OUML	126
	{ "ouml", KEY_SEMICOLON },
#define INDEX_TABLE_KEY_UUML	127
	{ "uuml", KEY_LEFTBRACKET },
	{ NULL, 0 }
};

/* キー割り当てのデフォルト */
static struct KeyAssign keyAssign[] = {
#define INDEX_KEY_ASSIGN_Z	0
	{ BMKEY_Z, KEY_Z },
#define INDEX_KEY_ASSIGN_X	1
	{ BMKEY_X, KEY_X },
#define INDEX_KEY_ASSIGN_C	2
	{ BMKEY_C, KEY_C },
#define INDEX_KEY_ASSIGN_V	3
	{ BMKEY_V, KEY_V },
#define INDEX_KEY_ASSIGN_B	4
	{ BMKEY_B, KEY_B },
#define INDEX_KEY_ASSIGN_N	5
	{ BMKEY_N, KEY_N },
#define INDEX_KEY_ASSIGN_M	6
	{ BMKEY_M, KEY_M },
#define INDEX_KEY_ASSIGN_COMMA	7
	{ BMKEY_COMMA, KEY_COMMA },
#define INDEX_KEY_ASSIGN_PERIOD	8
	{ BMKEY_PERIOD, KEY_PERIOD },
#define INDEX_KEY_ASSIGN_SLASH	9
	{ BMKEY_SLASH, KEY_SLASH },
#define INDEX_KEY_ASSIGN_UNDERBAR	10
	{ BMKEY_UNDERBAR, KEY_DELETE },
#define INDEX_KEY_ASSIGN_SPACE	11
	{ BMKEY_SPACE, KEY_SPACE },
#define INDEX_KEY_ASSIGN_A	12
	{ BMKEY_A, KEY_A },
#define INDEX_KEY_ASSIGN_S	13
	{ BMKEY_S, KEY_S },
#define INDEX_KEY_ASSIGN_D	14
	{ BMKEY_D, KEY_D },
#define INDEX_KEY_ASSIGN_F	15
	{ BMKEY_F, KEY_F },
#define INDEX_KEY_ASSIGN_G	16
	{ BMKEY_G, KEY_G },
#define INDEX_KEY_ASSIGN_H	17
	{ BMKEY_H, KEY_H },
#define INDEX_KEY_ASSIGN_J	18
	{ BMKEY_J, KEY_J },
#define INDEX_KEY_ASSIGN_K	19
	{ BMKEY_K, KEY_K },
#define INDEX_KEY_ASSIGN_L	20
	{ BMKEY_L, KEY_L },
#define INDEX_KEY_ASSIGN_SEMICOLON	21
	{ BMKEY_SEMICOLON, KEY_SEMICOLON },
#define INDEX_KEY_ASSIGN_COLON	22
	{ BMKEY_COLON, KEY_QUOTE },
#define INDEX_KEY_ASSIGN_RIGHTBRACKET	23
	{ BMKEY_RIGHTBRACKET, KEY_RIGHTBRACKET },
#define INDEX_KEY_ASSIGN_RETURN	24
	{ BMKEY_RETURN, KEY_RETURN },
#define INDEX_KEY_ASSIGN_Q	25
	{ BMKEY_Q, KEY_Q },
#define INDEX_KEY_ASSIGN_W	26
	{ BMKEY_W, KEY_W },
#define INDEX_KEY_ASSIGN_E	27
	{ BMKEY_E, KEY_E },
#define INDEX_KEY_ASSIGN_R	28
	{ BMKEY_R, KEY_R },
#define INDEX_KEY_ASSIGN_T	29
	{ BMKEY_T, KEY_T },
#define INDEX_KEY_ASSIGN_Y	30
	{ BMKEY_Y, KEY_Y },
#define INDEX_KEY_ASSIGN_U	31
	{ BMKEY_U, KEY_U },
#define INDEX_KEY_ASSIGN_I	32
	{ BMKEY_I, KEY_I },
#define INDEX_KEY_ASSIGN_O	33
	{ BMKEY_O, KEY_O },
#define INDEX_KEY_ASSIGN_P	34
	{ BMKEY_P, KEY_P },
#define INDEX_KEY_ASSIGN_AT	35
	{ BMKEY_AT, KEY_BACKSLASH },
#define INDEX_KEY_ASSIGN_LEFTBRACKET	36
	{ BMKEY_LEFTBRACKET, KEY_LEFTBRACKET },
#define INDEX_KEY_ASSIGN_DELETE	37
	{ BMKEY_DELETE, KEY_BACKSPACE },
#define INDEX_KEY_ASSIGN_1	38
	{ BMKEY_1, KEY_1 },
#define INDEX_KEY_ASSIGN_2	39
	{ BMKEY_2, KEY_2 },
#define INDEX_KEY_ASSIGN_3	40
	{ BMKEY_3, KEY_3 },
#define INDEX_KEY_ASSIGN_4	41
	{ BMKEY_4, KEY_4 },
#define INDEX_KEY_ASSIGN_5	42
	{ BMKEY_5, KEY_5 },
#define INDEX_KEY_ASSIGN_6	43
	{ BMKEY_6, KEY_6 },
#define INDEX_KEY_ASSIGN_7	44
	{ BMKEY_7, KEY_7 },
#define INDEX_KEY_ASSIGN_8	45
	{ BMKEY_8, KEY_8 },
#define INDEX_KEY_ASSIGN_9	46
	{ BMKEY_9, KEY_9 },
#define INDEX_KEY_ASSIGN_0	47
	{ BMKEY_0, KEY_0 },
#define INDEX_KEY_ASSIGN_MINUS	48
	{ BMKEY_MINUS, KEY_MINUS },
#define INDEX_KEY_ASSIGN_CARET	49
	{ BMKEY_CARET, KEY_EQUALS },
#define INDEX_KEY_ASSIGN_YEN	50
	{ BMKEY_YEN, KEY_INSERT },
#define INDEX_KEY_ASSIGN_ALPHA	51
	{ BMKEY_ALPHA, KEY_LCTRL },
#define INDEX_KEY_ASSIGN_ASHIFT	52
	{ BMKEY_ASHIFT, KEY_LSHIFT },
#define INDEX_KEY_ASSIGN_KSHIFT	53
	{ BMKEY_KSHIFT, KEY_RCTRL },
#define INDEX_KEY_ASSIGN_KANA	54
	{ BMKEY_KANA, KEY_RSHIFT },
#define INDEX_KEY_ASSIGN_BREAK	55
	{ BMKEY_BREAK, KEY_ESCAPE },
#define INDEX_KEY_ASSIGN_OVERWRITE	56
	{ BMKEY_OVERWRITE, KEY_PAGEUP },
#define INDEX_KEY_ASSIGN_APPEND	57
	{ BMKEY_APPEND, KEY_PAGEDOWN },
	{ 0, 0 }
};

/* フォント */
static uint8 fontDefault[256][8] = {
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
	{ 0xff, 0xff, 0xff, 0xff, 0xf0, 0xf0, 0xf0, 0xf0 },
	{ 0xf0, 0xf0, 0xf0, 0xf0, 0x0f, 0x0f, 0x0f, 0x0f },
	{ 0x00, 0x00, 0x00, 0x00, 0xf0, 0xf0, 0xf0, 0xf0 },
	{ 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f },
	{ 0xf0, 0xf0, 0xf0, 0xf0, 0xff, 0xff, 0xff, 0xff },
	{ 0xf0, 0xf0, 0xf0, 0xf0, 0x00, 0x00, 0x00, 0x00 },
	{ 0x0f, 0x0f, 0x0f, 0x0f, 0xff, 0xff, 0xff, 0xff },
	{ 0x0f, 0x0f, 0x0f, 0x0f, 0x00, 0x00, 0x00, 0x00 },
	{ 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0 },
	{ 0xff, 0xff, 0xff, 0xff, 0x0f, 0x0f, 0x0f, 0x0f },
	{ 0x0f, 0x0f, 0x0f, 0x0f, 0xf0, 0xf0, 0xf0, 0xf0 },
	{ 0x00, 0x00, 0x00, 0x00, 0x0f, 0x0f, 0x0f, 0x0f },
	{ 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff },
	{ 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00 },
	{ 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff },
	{ 0x00, 0x00, 0x00, 0x34, 0x48, 0x48, 0x48, 0x34 },
	{ 0x00, 0x38, 0x44, 0x78, 0x44, 0x44, 0x78, 0x40 },
	{ 0x00, 0x00, 0x00, 0x40, 0x2c, 0x30, 0x20, 0x20 },
	{ 0x00, 0x00, 0x00, 0x58, 0x24, 0x24, 0x24, 0x04 },
	{ 0x00, 0x38, 0x44, 0x44, 0x7c, 0x44, 0x44, 0x38 },
	{ 0x00, 0x00, 0x00, 0x60, 0x10, 0x10, 0x28, 0x44 },
	{ 0x00, 0x00, 0x24, 0x24, 0x24, 0x3a, 0x20, 0x40 },
	{ 0x00, 0x00, 0x00, 0x7c, 0x28, 0x28, 0x28, 0x4c },
	{ 0x00, 0x00, 0x00, 0x7c, 0x10, 0x10, 0x10, 0x08 },
	{ 0x00, 0x10, 0x38, 0x54, 0x54, 0x54, 0x38, 0x10 },
	{ 0x00, 0x10, 0x10, 0x54, 0x54, 0x38, 0x10, 0x10 },
	{ 0x00, 0x00, 0x00, 0x28, 0x44, 0x54, 0x54, 0x28 },
	{ 0x00, 0xfe, 0x40, 0x20, 0x10, 0x20, 0x40, 0xfe },
	{ 0x00, 0x38, 0x44, 0x82, 0x82, 0x44, 0x28, 0xee },
	{ 0x00, 0x00, 0x00, 0x64, 0x28, 0x10, 0x28, 0x4c },
	{ 0x00, 0x10, 0x00, 0x00, 0x7c, 0x00, 0x00, 0x10 },
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
	{ 0x00, 0x10, 0x10, 0x10, 0x10, 0x10, 0x00, 0x10 },
	{ 0x00, 0x28, 0x28, 0x00, 0x00, 0x00, 0x00, 0x00 },
	{ 0x00, 0x28, 0x28, 0x7c, 0x28, 0x7c, 0x28, 0x28 },
	{ 0x00, 0x10, 0x38, 0x50, 0x38, 0x14, 0x38, 0x10 },
	{ 0x00, 0x64, 0x64, 0x08, 0x10, 0x20, 0x4c, 0x4c },
	{ 0x00, 0x20, 0x50, 0x50, 0x24, 0x54, 0x48, 0x34 },
	{ 0x00, 0x10, 0x10, 0x20, 0x00, 0x00, 0x00, 0x00 },
	{ 0x00, 0x08, 0x10, 0x10, 0x10, 0x10, 0x10, 0x08 },
	{ 0x00, 0x10, 0x08, 0x08, 0x08, 0x08, 0x08, 0x10 },
	{ 0x00, 0x00, 0x10, 0x54, 0x38, 0x54, 0x10, 0x00 },
	{ 0x00, 0x00, 0x10, 0x10, 0x7c, 0x10, 0x10, 0x00 },
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x10, 0x20 },
	{ 0x00, 0x00, 0x00, 0x00, 0x7c, 0x00, 0x00, 0x00 },
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x30 },
	{ 0x00, 0x00, 0x04, 0x08, 0x10, 0x20, 0x40, 0x00 },
	{ 0x00, 0x38, 0x44, 0x4c, 0x54, 0x64, 0x44, 0x38 },
	{ 0x00, 0x10, 0x30, 0x10, 0x10, 0x10, 0x10, 0x38 },
	{ 0x00, 0x38, 0x44, 0x04, 0x08, 0x10, 0x20, 0x7c },
	{ 0x00, 0x7c, 0x08, 0x10, 0x38, 0x04, 0x44, 0x38 },
	{ 0x00, 0x08, 0x18, 0x28, 0x48, 0x7c, 0x08, 0x08 },
	{ 0x00, 0x78, 0x40, 0x78, 0x04, 0x04, 0x44, 0x38 },
	{ 0x00, 0x18, 0x20, 0x40, 0x78, 0x44, 0x44, 0x38 },
	{ 0x00, 0x7c, 0x04, 0x08, 0x10, 0x10, 0x10, 0x10 },
	{ 0x00, 0x38, 0x44, 0x44, 0x38, 0x44, 0x44, 0x38 },
	{ 0x00, 0x38, 0x44, 0x44, 0x3c, 0x04, 0x08, 0x30 },
	{ 0x00, 0x30, 0x30, 0x00, 0x00, 0x30, 0x30, 0x00 },
	{ 0x00, 0x30, 0x30, 0x00, 0x00, 0x30, 0x10, 0x20 },
	{ 0x00, 0x04, 0x08, 0x10, 0x20, 0x10, 0x08, 0x04 },
	{ 0x00, 0x00, 0x00, 0x3c, 0x00, 0x3c, 0x00, 0x00 },
	{ 0x00, 0x20, 0x10, 0x08, 0x04, 0x08, 0x10, 0x20 },
	{ 0x00, 0x38, 0x44, 0x04, 0x08, 0x10, 0x00, 0x10 },
	{ 0x00, 0x38, 0x44, 0x5c, 0x54, 0x5c, 0x40, 0x38 },
	{ 0x00, 0x10, 0x28, 0x44, 0x44, 0x7c, 0x44, 0x44 },
	{ 0x00, 0x78, 0x24, 0x24, 0x38, 0x24, 0x24, 0x78 },
	{ 0x00, 0x38, 0x44, 0x40, 0x40, 0x40, 0x44, 0x38 },
	{ 0x00, 0x78, 0x24, 0x24, 0x24, 0x24, 0x24, 0x78 },
	{ 0x00, 0x7c, 0x40, 0x40, 0x78, 0x40, 0x40, 0x7c },
	{ 0x00, 0x7c, 0x40, 0x40, 0x78, 0x40, 0x40, 0x40 },
	{ 0x00, 0x38, 0x44, 0x40, 0x4c, 0x44, 0x44, 0x38 },
	{ 0x00, 0x44, 0x44, 0x44, 0x7c, 0x44, 0x44, 0x44 },
	{ 0x00, 0x38, 0x10, 0x10, 0x10, 0x10, 0x10, 0x38 },
	{ 0x00, 0x1c, 0x08, 0x08, 0x08, 0x48, 0x48, 0x30 },
	{ 0x00, 0x44, 0x48, 0x50, 0x60, 0x50, 0x48, 0x44 },
	{ 0x00, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x7c },
	{ 0x00, 0x44, 0x6c, 0x54, 0x54, 0x44, 0x44, 0x44 },
	{ 0x00, 0x44, 0x44, 0x64, 0x54, 0x4c, 0x44, 0x44 },
	{ 0x00, 0x38, 0x44, 0x44, 0x44, 0x44, 0x44, 0x38 },
	{ 0x00, 0x78, 0x44, 0x44, 0x78, 0x40, 0x40, 0x40 },
	{ 0x00, 0x38, 0x44, 0x44, 0x44, 0x54, 0x48, 0x34 },
	{ 0x00, 0x78, 0x44, 0x44, 0x78, 0x50, 0x48, 0x44 },
	{ 0x00, 0x38, 0x44, 0x40, 0x38, 0x04, 0x44, 0x38 },
	{ 0x00, 0x7c, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10 },
	{ 0x00, 0x44, 0x44, 0x44, 0x44, 0x44, 0x44, 0x38 },
	{ 0x00, 0x44, 0x44, 0x44, 0x44, 0x44, 0x28, 0x10 },
	{ 0x00, 0x44, 0x44, 0x44, 0x54, 0x54, 0x6c, 0x44 },
	{ 0x00, 0x44, 0x44, 0x28, 0x10, 0x28, 0x44, 0x44 },
	{ 0x00, 0x44, 0x44, 0x28, 0x10, 0x10, 0x10, 0x10 },
	{ 0x00, 0x7c, 0x04, 0x08, 0x10, 0x20, 0x40, 0x7c },
	{ 0x00, 0x18, 0x10, 0x10, 0x10, 0x10, 0x10, 0x18 },
	{ 0x00, 0x44, 0x28, 0x10, 0x7c, 0x10, 0x7c, 0x10 },
	{ 0x00, 0x18, 0x08, 0x08, 0x08, 0x08, 0x08, 0x18 },
	{ 0x00, 0x10, 0x28, 0x44, 0x00, 0x00, 0x00, 0x00 },
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7c },
	{ 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff },
	{ 0x00, 0x00, 0x00, 0x38, 0x48, 0x48, 0x48, 0x34 },
	{ 0x00, 0x40, 0x40, 0x70, 0x48, 0x48, 0x48, 0x70 },
	{ 0x00, 0x00, 0x00, 0x38, 0x40, 0x40, 0x40, 0x38 },
	{ 0x00, 0x08, 0x08, 0x38, 0x48, 0x48, 0x48, 0x38 },
	{ 0x00, 0x00, 0x00, 0x30, 0x48, 0x78, 0x40, 0x38 },
	{ 0x00, 0x18, 0x20, 0x20, 0x78, 0x20, 0x20, 0x20 },
	{ 0x00, 0x30, 0x48, 0x48, 0x38, 0x08, 0x48, 0x30 },
	{ 0x00, 0x40, 0x40, 0x40, 0x70, 0x48, 0x48, 0x48 },
	{ 0x00, 0x00, 0x20, 0x00, 0x20, 0x20, 0x20, 0x20 },
	{ 0x00, 0x00, 0x08, 0x00, 0x08, 0x08, 0x48, 0x30 },
	{ 0x00, 0x40, 0x40, 0x48, 0x50, 0x60, 0x50, 0x48 },
	{ 0x00, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20 },
	{ 0x00, 0x00, 0x00, 0x68, 0x54, 0x54, 0x54, 0x54 },
	{ 0x00, 0x00, 0x00, 0x70, 0x48, 0x48, 0x48, 0x48 },
	{ 0x00, 0x00, 0x00, 0x30, 0x48, 0x48, 0x48, 0x30 },
	{ 0x00, 0x00, 0x00, 0x70, 0x48, 0x48, 0x70, 0x40 },
	{ 0x00, 0x00, 0x00, 0x38, 0x48, 0x48, 0x38, 0x08 },
	{ 0x00, 0x00, 0x00, 0x58, 0x60, 0x40, 0x40, 0x40 },
	{ 0x00, 0x00, 0x00, 0x38, 0x40, 0x30, 0x08, 0x70 },
	{ 0x00, 0x00, 0x20, 0x78, 0x20, 0x20, 0x20, 0x18 },
	{ 0x00, 0x00, 0x00, 0x48, 0x48, 0x48, 0x48, 0x38 },
	{ 0x00, 0x00, 0x00, 0x48, 0x48, 0x48, 0x50, 0x60 },
	{ 0x00, 0x00, 0x00, 0x54, 0x54, 0x54, 0x54, 0x28 },
	{ 0x00, 0x00, 0x00, 0x44, 0x28, 0x10, 0x28, 0x44 },
	{ 0x00, 0x00, 0x00, 0x48, 0x48, 0x38, 0x08, 0x70 },
	{ 0x00, 0x00, 0x00, 0x78, 0x08, 0x10, 0x20, 0x78 },
	{ 0x00, 0x00, 0x10, 0x20, 0x7e, 0x20, 0x10, 0x00 },
	{ 0x00, 0x00, 0x08, 0x04, 0x7e, 0x04, 0x08, 0x00 },
	{ 0x00, 0x10, 0x10, 0x10, 0x54, 0x38, 0x10, 0x00 },
	{ 0x00, 0x10, 0x38, 0x54, 0x10, 0x10, 0x10, 0x00 },
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
	{ 0x10, 0x10, 0x10, 0x10, 0xff, 0x10, 0x10, 0x10 },
	{ 0x10, 0x10, 0x10, 0x10, 0x1f, 0x00, 0x00, 0x00 },
	{ 0x10, 0x10, 0x10, 0x10, 0xf0, 0x00, 0x00, 0x00 },
	{ 0x00, 0x00, 0x00, 0x00, 0xf0, 0x10, 0x10, 0x10 },
	{ 0x00, 0x00, 0x00, 0x00, 0x1f, 0x10, 0x10, 0x10 },
	{ 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00 },
	{ 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10 },
	{ 0x10, 0x10, 0x10, 0x38, 0xff, 0x38, 0x10, 0x10 },
	{ 0x10, 0x10, 0x10, 0x10, 0xf0, 0x10, 0x10, 0x10 },
	{ 0x00, 0x00, 0x00, 0x00, 0xff, 0x10, 0x10, 0x10 },
	{ 0x10, 0x10, 0x10, 0x10, 0x1f, 0x10, 0x10, 0x10 },
	{ 0x10, 0x10, 0x10, 0x10, 0xff, 0x00, 0x00, 0x00 },
	{ 0x08, 0x04, 0x02, 0x01, 0x00, 0x00, 0x00, 0x00 },
	{ 0x10, 0x20, 0x40, 0x80, 0x00, 0x00, 0x00, 0x00 },
	{ 0x00, 0x00, 0x00, 0x00, 0x80, 0x40, 0x20, 0x10 },
	{ 0x00, 0x00, 0x00, 0x00, 0x01, 0x02, 0x04, 0x08 },
	{ 0x10, 0x20, 0x40, 0x80, 0x80, 0x40, 0x20, 0x10 },
	{ 0x00, 0x00, 0x00, 0x00, 0x81, 0x42, 0x24, 0x18 },
	{ 0x08, 0x04, 0x02, 0x01, 0x01, 0x02, 0x04, 0x08 },
	{ 0x18, 0x24, 0x42, 0x81, 0x00, 0x00, 0x00, 0x00 },
	{ 0x00, 0x38, 0x44, 0x82, 0x82, 0x82, 0x44, 0x38 },
	{ 0x00, 0x38, 0x7c, 0xfe, 0xfe, 0xfe, 0x7c, 0x38 },
	{ 0x00, 0x38, 0x38, 0xd6, 0xfe, 0xd6, 0x10, 0x38 },
	{ 0x00, 0x10, 0x38, 0x7c, 0xfe, 0x7c, 0x38, 0x10 },
	{ 0x00, 0x6c, 0xfe, 0xfe, 0xfe, 0x7c, 0x38, 0x10 },
	{ 0x00, 0x10, 0x38, 0x7c, 0xfe, 0xfe, 0x10, 0x38 },
	{ 0x00, 0x54, 0x7c, 0x54, 0x10, 0x92, 0xfe, 0x92 },
	{ 0x00, 0x18, 0x14, 0x12, 0x12, 0x74, 0xf0, 0x60 },
	{ 0x00, 0x00, 0x00, 0xfe, 0xbe, 0xbe, 0xa2, 0x22 },
	{ 0x55, 0xaa, 0x55, 0xaa, 0x55, 0xaa, 0x55, 0xaa },
	{ 0x00, 0x10, 0x10, 0x38, 0x7c, 0xfe, 0x92, 0xba },
	{ 0x00, 0x00, 0x20, 0x10, 0x08, 0x04, 0x00, 0x00 },
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x28, 0x10 },
	{ 0x00, 0x00, 0x18, 0x10, 0x10, 0x10, 0x00, 0x00 },
	{ 0x00, 0x00, 0x08, 0x08, 0x08, 0x18, 0x00, 0x00 },
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x08, 0x04 },
	{ 0x00, 0x00, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00 },
	{ 0x00, 0x7c, 0x04, 0x7c, 0x04, 0x04, 0x08, 0x70 },
	{ 0x00, 0x00, 0x00, 0x7c, 0x04, 0x18, 0x10, 0x20 },
	{ 0x00, 0x00, 0x00, 0x04, 0x08, 0x70, 0x10, 0x10 },
	{ 0x00, 0x00, 0x00, 0x10, 0x7c, 0x44, 0x04, 0x18 },
	{ 0x00, 0x00, 0x00, 0x38, 0x10, 0x10, 0x10, 0x7c },
	{ 0x00, 0x00, 0x00, 0x10, 0x7c, 0x10, 0x30, 0x50 },
	{ 0x00, 0x00, 0x00, 0x10, 0x7c, 0x14, 0x10, 0x10 },
	{ 0x00, 0x00, 0x00, 0x38, 0x08, 0x08, 0x08, 0x7c },
	{ 0x00, 0x00, 0x00, 0x7c, 0x04, 0x3c, 0x04, 0x7c },
	{ 0x00, 0x00, 0x00, 0x54, 0x54, 0x04, 0x04, 0x78 },
	{ 0x00, 0x00, 0x00, 0x40, 0x3c, 0x00, 0x00, 0x00 },
	{ 0x00, 0x7c, 0x04, 0x04, 0x18, 0x10, 0x10, 0x20 },
	{ 0x00, 0x04, 0x08, 0x10, 0x30, 0x50, 0x10, 0x10 },
	{ 0x00, 0x10, 0x7c, 0x44, 0x04, 0x04, 0x08, 0x30 },
	{ 0x00, 0x38, 0x10, 0x10, 0x10, 0x10, 0x10, 0x7c },
	{ 0x00, 0x08, 0x7c, 0x08, 0x08, 0x18, 0x28, 0x48 },
	{ 0x00, 0x20, 0x7c, 0x24, 0x24, 0x24, 0x24, 0x4c },
	{ 0x00, 0x10, 0x10, 0x7c, 0x10, 0x7c, 0x10, 0x10 },
	{ 0x00, 0x3c, 0x24, 0x24, 0x44, 0x04, 0x08, 0x30 },
	{ 0x00, 0x20, 0x3c, 0x48, 0x08, 0x08, 0x10, 0x60 },
	{ 0x00, 0x7c, 0x04, 0x04, 0x04, 0x04, 0x04, 0x7c },
	{ 0x00, 0x28, 0x7c, 0x28, 0x28, 0x08, 0x10, 0x60 },
	{ 0x00, 0x70, 0x04, 0x04, 0x74, 0x04, 0x08, 0x70 },
	{ 0x00, 0x7c, 0x04, 0x04, 0x08, 0x10, 0x28, 0x44 },
	{ 0x00, 0x20, 0x7c, 0x24, 0x24, 0x20, 0x20, 0x1c },
	{ 0x00, 0x44, 0x24, 0x04, 0x04, 0x04, 0x08, 0x70 },
	{ 0x00, 0x3c, 0x24, 0x3c, 0x44, 0x04, 0x08, 0x30 },
	{ 0x00, 0x04, 0x38, 0x10, 0x7c, 0x10, 0x10, 0x20 },
	{ 0x00, 0x54, 0x54, 0x54, 0x04, 0x04, 0x08, 0x70 },
	{ 0x00, 0x38, 0x00, 0x7c, 0x10, 0x10, 0x10, 0x20 },
	{ 0x00, 0x10, 0x10, 0x10, 0x18, 0x14, 0x10, 0x10 },
	{ 0x00, 0x10, 0x7c, 0x10, 0x10, 0x10, 0x20, 0x40 },
	{ 0x00, 0x38, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7c },
	{ 0x00, 0x7c, 0x04, 0x04, 0x28, 0x10, 0x28, 0x44 },
	{ 0x00, 0x10, 0x7c, 0x04, 0x08, 0x10, 0x38, 0x54 },
	{ 0x00, 0x04, 0x04, 0x04, 0x04, 0x08, 0x10, 0x60 },
	{ 0x00, 0x10, 0x08, 0x04, 0x44, 0x44, 0x44, 0x44 },
	{ 0x00, 0x40, 0x40, 0x78, 0x40, 0x40, 0x40, 0x3c },
	{ 0x00, 0x7c, 0x04, 0x04, 0x04, 0x04, 0x08, 0x70 },
	{ 0x00, 0x00, 0x00, 0x20, 0x50, 0x08, 0x04, 0x00 },
	{ 0x00, 0x10, 0x38, 0x10, 0x10, 0x54, 0x54, 0x54 },
	{ 0x00, 0x7c, 0x04, 0x04, 0x04, 0x28, 0x10, 0x08 },
	{ 0x00, 0x7c, 0x00, 0x00, 0x38, 0x00, 0x00, 0x7c },
	{ 0x00, 0x08, 0x10, 0x20, 0x44, 0x44, 0x7c, 0x04 },
	{ 0x00, 0x04, 0x04, 0x04, 0x28, 0x10, 0x28, 0x40 },
	{ 0x00, 0x38, 0x10, 0x7c, 0x10, 0x10, 0x10, 0x0c },
	{ 0x00, 0x10, 0x7c, 0x14, 0x14, 0x10, 0x10, 0x10 },
	{ 0x00, 0x38, 0x08, 0x08, 0x08, 0x08, 0x08, 0x7c },
	{ 0x00, 0x7c, 0x04, 0x04, 0x3c, 0x04, 0x04, 0x7c },
	{ 0x00, 0x7c, 0x00, 0x7c, 0x04, 0x04, 0x08, 0x30 },
	{ 0x00, 0x44, 0x44, 0x44, 0x44, 0x04, 0x08, 0x30 },
	{ 0x00, 0x00, 0x50, 0x50, 0x54, 0x54, 0x58, 0x50 },
	{ 0x00, 0x40, 0x40, 0x40, 0x40, 0x44, 0x48, 0x70 },
	{ 0x00, 0x7c, 0x44, 0x44, 0x44, 0x44, 0x44, 0x7c },
	{ 0x00, 0x7c, 0x44, 0x44, 0x04, 0x04, 0x08, 0x70 },
	{ 0x00, 0x40, 0x20, 0x00, 0x00, 0x04, 0x08, 0x70 },
	{ 0x00, 0x50, 0x28, 0x00, 0x00, 0x00, 0x00, 0x00 },
	{ 0x00, 0x20, 0x50, 0x20, 0x00, 0x00, 0x00, 0x00 },
	{ 0x00, 0x74, 0x5f, 0x74, 0x5f, 0x72, 0x0a, 0x06 },
	{ 0x00, 0x1c, 0x22, 0x41, 0x3e, 0x12, 0x12, 0x26 },
	{ 0x00, 0x12, 0x62, 0x27, 0x7b, 0x21, 0x72, 0x2c },
	{ 0x00, 0x28, 0x7e, 0x48, 0x3e, 0x28, 0x7f, 0x08 },
	{ 0x00, 0x3e, 0x22, 0x3e, 0x22, 0x3e, 0x22, 0x46 },
	{ 0x00, 0x3e, 0x22, 0x22, 0x3e, 0x22, 0x22, 0x3e },
	{ 0x00, 0x08, 0x2a, 0x2a, 0x08, 0x14, 0x22, 0x41 },
	{ 0x00, 0x08, 0x0a, 0x7c, 0x18, 0x1c, 0x2a, 0x49 },
	{ 0x00, 0x08, 0x3e, 0x08, 0x1c, 0x2a, 0x49, 0x08 },
	{ 0x00, 0x08, 0x14, 0x3e, 0x49, 0x1c, 0x2a, 0x7f },
	{ 0x00, 0x08, 0x08, 0x3e, 0x08, 0x08, 0x08, 0x7f },
	{ 0x00, 0x08, 0x08, 0x08, 0x08, 0x14, 0x22, 0x41 },
	{ 0x00, 0x0c, 0x08, 0x1c, 0x14, 0x1c, 0x41, 0x55 },
	{ 0x00, 0x7f, 0x41, 0x5d, 0x55, 0x5d, 0x41, 0x7f },
	{ 0x00, 0x08, 0x7f, 0x14, 0x14, 0x08, 0x14, 0x63 },
	{ 0x00, 0x1e, 0x22, 0x54, 0x08, 0x3f, 0x49, 0x0f },
	{ 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80 },
	{ 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0 },
	{ 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0 },
	{ 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01 },
	{ 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03 },
	{ 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07 },
	{ 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
	{ 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
	{ 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00 },
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff },
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff },
	{ 0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80 },
	{ 0x80, 0x40, 0x20, 0x10, 0x08, 0x04, 0x02, 0x01 },
	{ 0x81, 0xc3, 0xe7, 0xff, 0xff, 0xe7, 0xc3, 0x81 },
	{ 0xff, 0x7e, 0x3c, 0x18, 0x18, 0x3c, 0x7e, 0xff }
};

static char bin_path[PATH_MAX];
static int bin_adr;
static time_t load_time;

/*
	ログを出力する
*/
void m68log(const struct M68stat *m68)
{
#if 0
	char buf[256];

	/*
	if(m68->pc < 0x40 || m68->pc > 0xe000)
		return;
	*/
	printf("%s\n", m68regs(buf, m68));
	printf("%dclocks\n\n", m68states(m68));
#endif
}

/*
	文字列(16進数)を数値にする (getFileの下請け)
*/
static int atoix(const char *buf)
{
	int val;

	sscanf(buf, "%x", &val);
	return val;
}

/*
	オプションからファイル名とアドレスを得る (initの下請け)
*/
static int getFile(char **file, int *address, int argc, char *argv[])
{
	int i;

	for(i = 1; i < argc; i++) {
		if(*argv[i] == '-')
			continue;
		*file = argv[i];
		for(i = i + 1; i < argc; i++) {
			if(*argv[i] == '-')
				continue;
			*address = atoix(argv[i]);
			return 2;
		}
		return 1;
	}
	return 0;
}

/*
	エミュレータを初期化する (下請け)
*/
int init(struct Bm2stat *bm2, int argc, char *argv[])
{
	Conf conf[256];
	const OptTable *b;
	const struct KeyAssign *k;
	const char *display;
	char *file, rom_dir[PATH_MAX], rom_path[PATH_MAX];
	int i, address = 0xc000;

	memset(bm2, 0, sizeof(*bm2));

	/* 設定ファイルを読み込む */
	getConfig(conf, sizeof(conf) / sizeof(conf[0]), "bm2config", argc, argv);

	/* ディスプレイ */
	display = getOptText(conf, "display", "c");
	if(strcasecmp(display, "color") == 0 || strcasecmp(display, "c") == 0)
		bm2->display = 0;
	else if(strcasecmp(display, "green") == 0 || strcasecmp(display, "g") == 0)
		bm2->display = 0x00ff00;
	else
		bm2->display = atoix(display);

	/* CPUを初期化する */
	bm2->cpu = m68init(bm2->memory, bm2);
	if((bm2->cpu_freq = getOptInt(conf, "clock", 750) * 1000) <= 0)
		bm2->cpu_freq = 750 * 1000;

	/* メモリを初期化する */
	bm2->ram_end = getOptTable(conf, "ram_size", tableRam, 0x3fff);
	for(i = 0x100; i < 0xb000; i++)
		bm2->memory[i] = (i & 0x0040 ? 0x00: 0xff);
	for(i = 0; i < 0x3800; i++)
		bm2->memory[i] = (i & 0x0040 ? 0x00: 0xff);
	for(i = 0; i < 0x1000; i++)
		bm2->memory[i] = (i & 0x0040 ? 0x00: 0xff);

	/* カラーアダプタを初期化する */
	bm2->mp1710 = getOptTable(conf, "mp1710", tableYesNo, TRUE);
	for(i = 0; i < sizeof(bm2->color_map); i++)
		bm2->color_map[i] = rand() & 0xff;
	bm2->mp1710on = FALSE;
	bm2->wtenbl = 0;

	/* スクリーンモードを初期化する */
	bm2->screen_mode = 0;
	bm2->reverse = 0;

	/* キーを初期化する */
	bm2->keyconv[KEY_INSERT] = BMKEY_YEN;
	bm2->keyconv[KEY_DELETE] = BMKEY_UNDERBAR;
	switch(getOptTable(conf, "keyboard", tableKeyboard, KEYBOARD_EN)) {
	case KEYBOARD_JP:
		tableKey[INDEX_TABLE_KEY_LEFTBRACKET].value = KEY_RIGHTBRACKET;
		tableKey[INDEX_TABLE_KEY_RIGHTBRACKET].value = KEY_BACKSLASH;
		/*
		tableKey[INDEX_TABLE_KEY_COLON].value = KEY_QUOTE;
		tableKey[INDEX_TABLE_KEY_AT].value = KEY_LEFTBRACKET;
		tableKey[INDEX_TABLE_KEY_CARET].value = KEY_EQUALS;
		*/
		keyAssign[INDEX_KEY_ASSIGN_COLON].key = KEY_QUOTE;
		keyAssign[INDEX_KEY_ASSIGN_RIGHTBRACKET].key = KEY_BACKSLASH;
		keyAssign[INDEX_KEY_ASSIGN_AT].key = KEY_LEFTBRACKET;
		keyAssign[INDEX_KEY_ASSIGN_LEFTBRACKET].key = KEY_RIGHTBRACKET;
		keyAssign[INDEX_KEY_ASSIGN_CARET].key = KEY_EQUALS;
		keyAssign[INDEX_KEY_ASSIGN_YEN].key = KEY_YEN;
		keyAssign[INDEX_KEY_ASSIGN_UNDERBAR].key = KEY_UNDERBAR;
		break;
	case KEYBOARD_DE:
		tableKey[INDEX_TABLE_KEY_HASH].value = KEY_BACKSLASH;
		tableKey[INDEX_TABLE_KEY_Y].value = KEY_Z;
		tableKey[INDEX_TABLE_KEY_Z].value = KEY_Y;
		tableKey[INDEX_TABLE_KEY_PLUS].value = KEY_RIGHTBRACKET;
		tableKey[INDEX_TABLE_KEY_MINUS].value = KEY_SLASH;
		tableKey[INDEX_TABLE_KEY_SLASH].value = KEY_MINUS;
		/*
		tableKey[INDEX_TABLE_KEY_ACUTE].value = KEY_EQUALS;
		tableKey[INDEX_TABLE_KEY_SZLIG].value = KEY_MINUS;
		tableKey[INDEX_TABLE_KEY_AUML].value = KEY_QUOTE;
		tableKey[INDEX_TABLE_KEY_OUML].value = KEY_SEMICOLON;
		tableKey[INDEX_TABLE_KEY_UUML].value = KEY_LEFTBRACKET;
		*/
		keyAssign[INDEX_KEY_ASSIGN_Y].key = KEY_Z;
		keyAssign[INDEX_KEY_ASSIGN_Z].key = KEY_Y;
		keyAssign[INDEX_KEY_ASSIGN_MINUS].key = KEY_SLASH;
		keyAssign[INDEX_KEY_ASSIGN_SLASH].key = KEY_MINUS;
		break;
	}
	for(k = keyAssign; k->key != 0; k++)
		bm2->keyconv[k->key] = k->bmkey;
	for(b = tableBmkey; b->string != NULL; b++)
		bm2->keyconv[getOptTable(conf, b->string, tableKey, KEY_NONE)] = b->value;
	bm2->key_strobe = 0;
	bm2->key_mod = 0xf0;
	memset(bm2->key_mat, 0x0f, sizeof(bm2->key_mat));
	bm2->key_break = FALSE;

	/* サウンドを初期化する */
	bm2->use_sound = getOptTable(conf, "sound", tableYesNo, TRUE);
	if(bm2->use_sound) {
		bm2->sound_sample_size = getSoundSampleSize(60);
		bm2->sound_buffer_size = bm2->sound_sample_size * 4;
		bm2->sound_buffer = calloc(1, bm2->sound_buffer_size);
		bm2->sound_read_pointer = bm2->sound_buffer + 2 * bm2->sound_sample_size;
		bm2->sound_write_pointer = bm2->sound_buffer;
		bm2->io_freq = 44100 / bm2->sound_sample_size;
	} else
		bm2->io_freq = 60;
	bm2->sound_tape = FALSE;
	bm2->fast = FALSE;

	/* テープを初期化する */
	setTape(bm2, "noname.bin");
	if(getFile(&file, &address, argc, argv) > 0)
		if(readSRecord(file, bm2->cpu.m, NULL, 0x10000, FALSE) <= 0)
			strcpy(bm2->tape_path, file);

	/* ROMイメージを読み込む */
	setHomeDir(rom_dir, getOptText(conf, "rom_dir", ""));
	if(strcmp(rom_dir, "") != 0) {
		bm2->cpu.emulate_subroutine = FALSE;
		bm2->ram_rom = 0x00;

		sprintf(rom_path, "%s/b000-e7ff.s", rom_dir);
		if(readSRecordAbs(rom_path, bm2->rom_b000_e7ff, 0, 0x3800, 0) <= 0) {
			sprintf(rom_path, "%s/bas.rom", rom_dir);
			if(readBin(rom_path, bm2->rom_b000_e7ff + 00000, 0x3000) <= 0) {
				popup("ERROR: Cannot read ROM file \"%s\"", rom_path);
				return FALSE;
			}
			sprintf(rom_path, "%s/prt.rom", rom_dir);
			if(readBin(rom_path, bm2->rom_b000_e7ff + 0x3000, 0x800) <= 0) {
				popup("ERROR: Cannot read ROM file \"%s\"", rom_path);
				return FALSE;
			}
		}
		sprintf(rom_path, "%s/f000-ffff.s", rom_dir);
		if(readSRecordAbs(rom_path, bm2->rom_f000_ffff, 0, 0x1000, 0) <= 0) {
			sprintf(rom_path, "%s/mon.rom", rom_dir);
			if(readBin(rom_path, bm2->rom_f000_ffff, 0x1000) <= 0) {
				popup("ERROR: Cannot read ROM file. \"%s\"", rom_path);
				return FALSE;
			}
		}

		memcpy(&bm2->cpu.m[0xb000], bm2->rom_b000_e7ff, 0x3800);
		memcpy(&bm2->cpu.m[0xf000], bm2->rom_f000_ffff, 0x1000);
	} else {
#ifdef CURMPU
		bm2->cpu.emulate_subroutine = TRUE;
		bm2->ram_rom = 0x07;

		for(i = 0xb000; i <= 0xe7ff; i++)
			bm2->cpu.m[i] = rand() & 0xff;
		for(i = 0xf000; i <= 0xffff; i++)
			bm2->cpu.m[i] = rand() & 0xff;

		if(bm2->ram_end <= 0xafff) {
			bm2->cpu.m[0x0008] = bm2->ram_end >> 8;
			bm2->cpu.m[0x0009] = bm2->ram_end & 0xff;
		} else {
			bm2->cpu.m[0x0008] = 0xaf;
			bm2->cpu.m[0x0009] = 0xff;
		}
		bm2->cpu.m[0x0028] = 0x7e;
		bm2->cpu.m[0x0029] = 0xf0;
		bm2->cpu.m[0x002a] = 0x12;
		bm2->cpu.m[0x002b] = 0x7e;
		bm2->cpu.m[0x002c] = 0xf0;
		bm2->cpu.m[0x002d] = 0x15;
		bm2->cpu.m[0xfff8] = 0xf0;
		bm2->cpu.m[0xfff9] = 0x4d;
		bm2->cpu.m[0xfffe] = address >> 8;
		bm2->cpu.m[0xffff] = address & 0xff;

		bm2->cpu.m[0xc000] = 0xbd;
		bm2->cpu.m[0xc001] = 0xf0;
		bm2->cpu.m[0xc002] = 0x00;
		bm2->cpu.m[0xc003] = 0x7e;
		bm2->cpu.m[0xc004] = 0xc0;
		bm2->cpu.m[0xc005] = 0x00;
		bm2->cpu.sp = ((uint16 )bm2->cpu.m[0x0008] << 8) | bm2->cpu.m[0x0009];
		bm2->cpu.cc = 0;
#else
		popup("ERROR: Cannot read ROM file. \"%s\"", rom_path);
		return FALSE;
#endif
	}

	/* フォントを読み込む */
	sprintf(rom_path, "%s/chr.bmp", rom_dir);
	if(!loadFontBmp(bm2, rom_path)) {
		sprintf(rom_path, "%s/font.rom", rom_dir);
		if(readBin(rom_path, bm2->rom_font, sizeof(bm2->rom_font)) <= 0)
			memcpy(bm2->rom_font, fontDefault, sizeof(bm2->rom_font));
	}
#ifdef CURMPU
	/* トレースモードか? */
	bm2->cpu.trace = getOptTable(conf, "debug", tableYesNo, FALSE);
#endif
	/* 画面の拡大率を設定する */
	bm2->zoom = getOptInt(conf, "zoom", 2);
	if(bm2->zoom < 1)
		bm2->zoom = 1;
	else if(bm2->zoom > 8)
		bm2->zoom = 8;

	/* 全ライン表示か? */
	bm2->full_line = getOptTable(conf, "full_line", tableYesNo, FALSE);

	setHomeDir(bin_path, getOptText(conf, "load_bin", ""));
	bin_adr = getOptHex(conf, "load_bin_adr", 0x4000);
	loadBinary(bm2);

	/* 環境依存部を初期化する */
	return initDepend(bm2, argc, argv);
}

void loadBinary(struct Bm2stat *bm2) {
	struct stat st;
	if (*bin_path && !stat(bin_path, &st) && load_time < st.st_mtimespec.tv_sec) {
		FILE *fi = fopen(bin_path, "rb");
		if (fi) {
			int c, i;
			for (i = bin_adr; i < 0xb000 && (c = getc(fi)) != EOF; i++)
				bm2->memory[i] = c;
			fclose(fi);
			if (bm2->ram_rom) {
				bm2->cpu.m[0xfffe] = bin_adr >> 8;
				bm2->cpu.m[0xffff] = bin_adr & 0xff;
			}
			fclose(fi);
			load_time = st.st_mtimespec.tv_sec;
			reset(bm2);
		}
	}
}

/*
	Copyright 2008, 2014 maruhiro
	All rights reserved. 

	Redistribution and use in source and binary forms, 
	with or without modification, are permitted provided that 
	the following conditions are met: 

	 1. Redistributions of source code must retain the above copyright notice, 
	    this list of conditions and the following disclaimer. 

	 2. Redistributions in binary form must reproduce the above copyright notice, 
	    this list of conditions and the following disclaimer in the documentation 
	    and/or other materials provided with the distribution. 

	THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, 
	INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND 
	FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL 
	THE REGENTS OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, 
	SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, 
	PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; 
	OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, 
	WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR 
	OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF 
	ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/

/* eof */
